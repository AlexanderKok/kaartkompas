# Feature 0003: User Flow Reorganization - PLAN

## Description

Reorganize the user flow of the web application to create a more logical navigation experience. Currently, the user paths are confusing with mismatched URLs, blank pages, and non-functional buttons. This plan restructures the routing to provide a clear, intuitive user journey from public landing to authenticated dashboard.

## Current Issues
- Main landing page (`/`) is cluttered and less appealing than the Hero component shown on non-authenticated `/menu-insights`
- `/login` route does not exist (blank page)
- Non-authenticated users hitting `/menu-insights` see a nice Hero component but cannot proceed anywhere
- `/dashboard` shows login form when not authenticated, creating confusion
- "Get Started Free" buttons don't provide immediate value to non-authenticated users

## Desired User Flow
1. **Main Landing (`/`)**: Show the Hero component (currently seen when accessing `/menu-insights` without login)
2. **Sign In (`/login`)**: Dedicated login page for authentication
3. **Public Upload (`/upload`)**: Non-authenticated users can upload PDFs and URLs with reCAPTCHA protection
4. **Authenticated Dashboard (`/dashboard`)**: Full application with sidebar for logged-in users

## Files That Need Changes

### 1. Core Routing Changes
- **File**: `ui/src/App.tsx`
  - Replace current `/` route to use Hero component instead of LandingPage
  - Add new `/login` route that shows LoginForm with proper styling
  - Add new `/upload` route for public upload functionality
  - Update `/menu-insights` to redirect authenticated users to dashboard
  - Remove `/dashboard` fallback login (should redirect to `/login` instead)

### 2. New Components to Create
- **File**: `ui/src/pages/Login.tsx` (new)
  - Dedicated login page component that wraps LoginForm with proper layout
  - Include branding and navigation back to main site

- **File**: `ui/src/pages/PublicUpload.tsx` (new)
  - Contains both MenuUpload and UrlUpload components
  - Includes reCAPTCHA integration before form submission
  - Shows upload interface without requiring authentication
  - Uses tabs for PDF vs URL upload options

### 3. Component Modifications
- **File**: `ui/src/pages/MenuInsights.tsx`
  - Remove the current non-authenticated Hero display
  - For non-authenticated users: redirect to `/upload` instead of showing Hero
  - For authenticated users: show the full dashboard interface
  - Update navigation button handlers

- **File**: `ui/src/components/Hero.tsx`
  - Update button handlers to point to `/upload` for "Get Started" actions
  - Update "Sign In" button to point to `/login`

- **File**: `ui/src/components/Header.tsx`
  - Update navigation buttons to use new routes
  - "Sign In" → `/login`
  - "Get Started" → `/upload`

- **File**: `ui/src/components/MenuUpload.tsx`
  - Add prop to control whether authentication is required
  - When used in public mode, integrate reCAPTCHA validation
  - Show appropriate messaging for non-authenticated vs authenticated usage

- **File**: `ui/src/components/UrlUpload.tsx`
  - Add prop to control whether authentication is required  
  - When used in public mode, integrate reCAPTCHA validation
  - Show appropriate messaging for non-authenticated vs authenticated usage

### 4. ReCAPTCHA Integration
- **File**: `package.json`
  - Add react-google-recaptcha dependency

- **Files**: Upload components
  - Integrate reCAPTCHA verification before form submission in public mode
  - Only require reCAPTCHA for non-authenticated users

### 5. Navigation Updates
- **File**: `ui/src/components/appSidebar.tsx`
  - No changes needed (only shows for authenticated users)

- **File**: `ui/src/components/navbar.tsx`
  - Verify it works correctly with new routing structure

## Implementation Algorithm

### Phase 1: Create New Components
1. Create `ui/src/pages/Login.tsx` - dedicated login page
2. Create `ui/src/pages/PublicUpload.tsx` - public upload interface
3. Add reCAPTCHA dependency to package.json

### Phase 2: Update Routing
1. Modify `ui/src/App.tsx`:
   - Change `/` route to show Hero component with updated handlers
   - Add `/login` route pointing to new Login page
   - Add `/upload` route pointing to new PublicUpload page
   - Update `/menu-insights` behavior for authenticated vs non-authenticated
   - Remove login fallback from `/dashboard` route

### Phase 3: Update Components
1. Modify `ui/src/components/Hero.tsx` - update button handlers
2. Modify `ui/src/components/Header.tsx` - update navigation links
3. Modify `ui/src/pages/MenuInsights.tsx` - handle authentication redirects
4. Update upload components to support public/authenticated modes

### Phase 4: ReCAPTCHA Integration
1. Add reCAPTCHA verification to public upload forms
2. Configure reCAPTCHA keys (user will need to add to .env)
3. Test upload functionality with and without authentication

## Technical Requirements

### Authentication Flow
- Non-authenticated users: `/` → `/upload` (can upload with reCAPTCHA) OR `/login` → `/dashboard`
- Authenticated users: `/` → `/dashboard` (or stay on landing) OR direct to `/dashboard`
- `/login` always accessible, redirects to `/dashboard` if already authenticated

### Upload Functionality  
- Public uploads require reCAPTCHA verification
- Authenticated uploads skip reCAPTCHA
- Both modes use same backend API endpoints
- Results handling may differ (public users get basic feedback, authenticated users get full dashboard)

### Route Protection
- `/dashboard/*` requires authentication (redirect to `/login` if not authenticated)
- `/upload` works for both authenticated and non-authenticated users
- `/login` redirects authenticated users to `/dashboard`

### Environment Configuration
User will need to add reCAPTCHA configuration to .env file:
```
VITE_RECAPTCHA_SITE_KEY=your_recaptcha_site_key
```