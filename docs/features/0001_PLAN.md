# Menu Insights Integration Plan

## Brief Description
Integrate the menu-insights Lovable project into the existing KaartKompas structure while maintaining clean organization and leveraging the existing authentication, database, and API infrastructure. The menu-insights project provides a restaurant menu analysis tool with file upload capabilities, multilingual support, and a demo consultation form.

## Current Architecture Analysis

### KaartKompas Structure
- **UI**: React + Vite + Tailwind + ShadCN components with Firebase Auth
- **Server**: Hono API with Supabase PostgreSQL database
- **Auth**: Firebase Auth with custom middleware
- **Build System**: pnpm workspace with database-server, server, and ui packages

### Menu-Insights Structure
- **Framework**: React + Vite + Tailwind + extensive ShadCN component library
- **Features**: Menu upload (PDF), URL analysis, consultation demo form
- **Additional Dependencies**: TanStack Query, react-dropzone, i18n, recharts, react-hook-form, zod
- **No Authentication**: Standalone application without auth integration

## Integration Strategy

### Phase 1: Dependency Alignment and Core Infrastructure

#### Files to Modify:
- `ui/package.json` - Add missing dependencies from menu-insights
- `ui/src/lib/utils.ts` - Ensure compatibility with additional ShadCN components
- `ui/components.json` - Verify ShadCN configuration alignment

#### Dependencies to Add:
```json
{
  "@hookform/resolvers": "^3.10.0",
  "@radix-ui/react-accordion": "^1.2.11",
  "@radix-ui/react-alert-dialog": "^1.1.14", 
  "@radix-ui/react-checkbox": "^1.3.2",
  "@radix-ui/react-collapsible": "^1.1.11",
  "@radix-ui/react-context-menu": "^2.2.15",
  "@radix-ui/react-hover-card": "^1.1.14",
  "@radix-ui/react-menubar": "^1.1.15",
  "@radix-ui/react-popover": "^1.1.14",
  "@radix-ui/react-progress": "^1.1.7",
  "@radix-ui/react-radio-group": "^1.3.7",
  "@radix-ui/react-scroll-area": "^1.2.9",
  "@radix-ui/react-select": "^2.2.5",
  "@radix-ui/react-slider": "^1.3.5",
  "@radix-ui/react-tabs": "^1.1.12",
  "@radix-ui/react-toast": "^1.2.14",
  "@radix-ui/react-toggle": "^1.1.9",
  "@radix-ui/react-toggle-group": "^1.1.10",
  "@tanstack/react-query": "^5.83.0",
  "cmdk": "^1.1.1",
  "date-fns": "^3.6.0",
  "embla-carousel-react": "^8.6.0",
  "i18next": "^25.3.2",
  "input-otp": "^1.4.2",
  "react-day-picker": "^8.10.1",
  "react-dropzone": "^14.3.8",
  "react-hook-form": "^7.61.1",
  "react-i18next": "^15.6.1",
  "react-resizable-panels": "^2.1.9",
  "recharts": "^2.15.4",
  "sonner": "^1.7.4",
  "vaul": "^0.9.9",
  "zod": "^3.25.76"
}
```

### Phase 2: Component Migration and Integration

#### New ShadCN Components to Add:
- Accordion, Alert Dialog, Checkbox, Collapsible, Context Menu
- Form, Hover Card, Menubar, Popover, Progress, Radio Group
- Scroll Area, Select, Slider, Tabs, Toast, Toggle, Toggle Group
- Carousel, Command, Date Picker, Input OTP, Resizable Panels, Drawer

#### Core Feature Components to Migrate:
- `ui/src/components/MenuUpload.tsx` - File upload with drag-drop functionality
- `ui/src/components/Hero.tsx` - Landing page hero section
- `ui/src/components/Header.tsx` - Public header component
- `ui/src/components/LanguageToggle.tsx` - i18n language switcher

#### New Pages to Create:
- `ui/src/pages/MenuInsights.tsx` - Main menu insights dashboard (replaces Index.tsx)
- `ui/src/pages/ConsultationDemo.tsx` - Restaurant consultation form (replaces Demo.tsx)

#### Integration Points:
- Modify `ui/src/App.tsx` to include new routes under authenticated sections
- Update `ui/src/components/appSidebar.tsx` to include menu insights navigation
- Integrate with existing auth context for protected routes

### Phase 3: Database Schema and API Integration

#### Database Schema Extensions:
- Create menu uploads table for file storage metadata
- Create restaurant consultations table for demo form submissions
- Add user associations for uploaded menus and consultations

#### API Endpoints to Create:
- `POST /api/menus/upload` - Handle file uploads and processing
- `GET /api/menus/user` - Retrieve user's uploaded menus
- `POST /api/consultations` - Store consultation demo submissions
- `GET /api/consultations/user` - Retrieve user's consultations

#### Files to Create/Modify:
- `server/src/schema/menus.ts` - Menu upload schema
- `server/src/schema/consultations.ts` - Consultation schema  
- `server/src/api.ts` - Add new route handlers
- File storage integration (consider Cloudflare R2 or Supabase Storage)

### Phase 4: Internationalization Setup

#### i18n Configuration:
- `ui/src/lib/i18n.ts` - Configure react-i18next
- `ui/public/locales/` - Language files directory structure
- `ui/src/main.tsx` - Initialize i18n provider

#### Translation Files Structure:
```
ui/public/locales/
├── en/
│   └── translation.json
└── nl/
    └── translation.json
```

### Phase 5: UI/UX Integration and Styling

#### Integration Approach:
- Maintain existing navbar and sidebar for authenticated users
- Create public landing page layout for menu insights
- Ensure consistent theming between existing and new components
- Adapt hero section to work within authenticated dashboard context

#### Route Structure:
```
/ - Existing home (authenticated)
/menu-insights - Public landing page for menu insights
/menu-insights/upload - Authenticated menu upload interface  
/menu-insights/dashboard - User's menu analysis dashboard
/consultation - Restaurant consultation demo form
/settings - Existing settings (add menu insights preferences)
```

## Technical Considerations

### Authentication Integration:
- Menu upload requires authentication
- Consultation demo can be public or gated
- User association for all uploaded content

### File Processing:
- PDF parsing and analysis backend implementation
- Integration with existing server infrastructure
- Consider external AI services for menu analysis

### Data Flow:
1. User uploads menu via drag-drop interface
2. File stored in cloud storage with metadata in database
3. Background processing for menu analysis
4. Results displayed in user dashboard
5. Historical analysis tracking

### Performance Considerations:
- Lazy loading for large component library
- Optimize bundle size with selective imports
- Consider code splitting for menu insights features

## Migration Steps

1. **Dependencies**: Install all required packages using `pnpm add`
2. **ShadCN Components**: Add missing components using `npx shadcn add`
3. **Core Components**: Migrate and adapt menu-insights components
4. **Database**: Implement schema changes and migrations
5. **API**: Create backend endpoints for file upload and processing
6. **i18n**: Set up internationalization infrastructure
7. **Routing**: Integrate new pages into existing router structure
8. **Testing**: Ensure all existing functionality remains intact

## Conflict Resolution

### Dependency Conflicts:
- React versions align (18.3.1 vs 19.1.0) - upgrade menu-insights to React 19
- React Router versions align (6.30.1 vs 7.6.0) - upgrade menu-insights
- Tailwind and ShadCN components are compatible
- No Firebase dependencies in menu-insights - clean integration

### Component Naming:
- No conflicts detected between existing components
- Menu-insights components use descriptive names (MenuUpload, Hero, etc.)

### Styling Conflicts:
- Both projects use Tailwind + ShadCN - minimal conflicts expected
- Ensure consistent design system variables